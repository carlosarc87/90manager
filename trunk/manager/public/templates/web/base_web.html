{% extends "base.html" %}

{% block css %}
    <link rel="stylesheet" href="/media/css/style.css" type="text/css" media="screen" />
{% endblock %}

{% block js %}
    <script src="/media/js/jquery-1.5.1.min.js" type="text/javascript"></script>
		
	<!-- No tocar que hay que arreglarlo un poco aun -->
	<script type="text/javascript">
		// Calcula el tiempo dependiendo de num1 y num2
		function calcularTiempo(segundos, num1, num2) {
			s = ((Math.floor(segundos / num1)) % num2).toString();
			if (s.length < 2)
				s = "0" + s;
			return "<b>" + s + "</b>";
		}

		// Actualiza el span con el texto
		function contadorDesactualizado(segundos) {
			if (segundos < 0) {
				document.getElementById("contador_desactualizado").innerHTML = "¡Actualizado!";
				return;
			}
			str_tiempo = formato_tiempo.replace(/%%D%%/g, calcularTiempo(segundos, 86400, 100000));
			str_tiempo = str_tiempo.replace(/%%H%%/g, calcularTiempo(segundos, 3600, 24));
			str_tiempo = str_tiempo.replace(/%%M%%/g, calcularTiempo(segundos, 60, 60));
			str_tiempo = str_tiempo.replace(/%%S%%/g, calcularTiempo(segundos, 1, 60));

			document.getElementById("contador_desactualizado").innerHTML = "Esto lleva desactualizado " + str_tiempo;

			setTimeout("contadorDesactualizado(" + (segundos + paso) + ")", timeout);
		}

		fechaUltimaActualizacion = "03/28/2011 16:40";
		formato_tiempo = "%%D%% días, %%H%% horas, %%M%% minutos y %%S%% segundos.";
		paso = +1;
		paso = Math.ceil(paso); // Filtrico

		var timeout = (Math.abs(paso) - 1) * 1000 + 990;
		var antes = new Date(fechaUltimaActualizacion);
		var ahora = new Date();
		dif = new Date(ahora - antes);
		gsegs = Math.floor(dif.valueOf() / 1000);
		
		// Al terminar de cargar la pagina (sino no encuentra el elemento 'contador_desactualizado')
		$(document).ready(function(){
			contadorDesactualizado(gsegs);
		});
	</script>
{% endblock %}

{% block contador_desactualizacion %}
	<div id="contador_desactualizacion">
		<span id="contador_desactualizado"></span>
	</div>
{% endblock %}
