{% extends "base_juego.html" %}

{% block situacion %}
	<ul id="menu_superior_situacion">
		<li><a href="/ligas/ver/{{ subasta.atributos_jugador.equipo.liga.id }}/">{{ subasta.atributos_jugador.equipo.liga.nombre }}</a></li>
		<li><a href="/equipos/ver/{{ subasta.atributos_jugador.equipo.id }}/">{{ subasta.atributos_jugador.equipo.nombre }}</a></li>
		<li><a href="/jugadores/ver/{{ subasta.atributos_jugador.jugador.id }}/">{{ subasta.atributos_jugador.jugador.nombre }}</a></li>
		<li><span>Subastar</span></li>
	</ul>
{% endblock %}

{% block js_extra %}
	<script type="text/javascript">
		// Indica confirmacion y envia el mensaje si confirma el usuario
		function compraDirecta() {
			var respuesta = confirm("¿Está seguro de querer comprar directamente por {{ subasta.compra_directa }}?")
			if (respuesta){
				location.href = '/mercado/subastas/comprar/{{ subasta.id }}/';
			}
		}
	</script>
{% endblock %}

{% block contenido %}
	<h2>{{ subasta.atributos_jugador.jugador.nombre }}</h2>

	{% if subasta.estado == 0 %}
		<ul>
			<li>Oferta actual: {{ subasta.oferta }}</li>
			{% if subasta.precio_compra %}
				<li>Precio de compra directa: {{ subasta.precio_compra }}</li>
			{% endif %}
			<li>Días que quedan: {{ subasta.expira }}</li>
			<li>Estado de la subasta: {{ subasta.estado }}</li>
			<li>Equipo vendedor: {{ subasta.vendedor }}</li>
		</ul>

		{% if subasta.comprador %}
		<p>
			<ul>
				<li>Comprador actual: {{ subasta.comprador }}</li>
			</ul>
		</p>
		{% else %}
			<p>No hay comprador aún</p>
		{% endif %}

		{% if form %}
			<form action="/mercado/subastas/ver/{{ subasta.id }}/" method="post">
				{% csrf_token %}
				<!-- Oferta -->
				<div id="contenido_oferta">
					{% if form.oferta.errors %}
						<p class="texto_error">{{ form.cantidad.errors }}</p>
					{% endif %}

					<div id="caja_oferta">
					<label for="id_oferta">Oferta:</label>
					{{ form.cantidad }}
					<input type="submit" value="Realizar oferta" />
					</div>
				</div>
			</form>

			{% if not subasta.compra_directa %}
				<input type = "submit" name = "boton_compra_directa" value = "Compra directa" onclick="compraDirecta()" />
			{% endif %}
		{% endif %}
	{% else %}
		{% if subasta.estado == 1 %}
			La subasta ya acabó
		{% else %}
			{% if subasta.estado == 2 %}
				Subasta comprada por {{ subasta.comprador }}
			{% else %}
				Error de estado de la subasta
			{% endif %}
		{% endif %}
	{% endif %}


{% endblock %}
